# WARNING - Generated by {fusen} from dev/flat_growth.Rmd: do not edit by hand


#' Plot outliers
#' 
#'Plot higlighting the outliers found by \code{Gro_remoutliers()}
#' 
#' @param data \code{data.frame} including at least the numeric columns *Age*, *MeasurementValue*, *keep1*, *keep2*, *keep3*, and *KEEP*
#' @param title \code{character} Title of the plot
#' @param xlimit \code{vector of 2 numeric} x limit for the plot
#' @param ylimit \code{vector of 2 numeric} y limit for the plot
#' 
#' @import dplyr assertthat 
#' @importFrom ggplot2 ggplot geom_point ggtitle aes xlim ylim
#'
#' @return Plot of the data points with outliers showed:
#'  - in red if detected using the maximum possible value
#'  - in green if detected using the inter quartile range
#'  - in cyan if detected using individual trajectories
#'  - in blue if detected from the global log-linear model
#' 
#' @export
#' @examples
#' data(weights)
#' weights = Gro_remoutliers(weights[weights$MeasurementType == "Live weight",], taxa = "Reptilia", ageMat = 10)
#'
#' p <- Gro_outplot(data = weights, 
#'                  title = "Species A", ylimit = c(0,2000))
#' p
Gro_outplot <- function(data, title = "", ylimit = NULL, xlimit = NULL) {
  assert_that(is.data.frame(data))
  assert_that(data %has_name% c("MeasurementValue","Age", 'keep1', 'keep2', 'keep3', "KEEP"))
  assert_that(is.numeric(data$MeasurementValue))
  assert_that(is.numeric(data$Age))
  
  if (is.null(xlimit)){
    xlimit = c(min(data$Age, na.rm = T), max(data$Age, na.rm = T))
  }
  if (is.null(ylimit)){
    ylimit = c(min(data$MeasurementValue, na.rm = T), max(data$MeasurementValue, na.rm = T))
  }
  assert_that(is.numeric(xlimit))
  assert_that(is.numeric(ylimit))
  
  p <- ggplot(data, aes(x = Age, y = MeasurementValue))+
    xlim(xlimit)+ ylim (ylimit)+
    geom_point()+
    ggtitle(title)+
    #Show the four steps used to remove outliers
    #1/ using maximum value
    geom_point(data = data%>%dplyr::filter(keep1==0), color = "red")+
    #2/ using Inter quartile range
    geom_point(data = data%>%dplyr::filter(keep2==0, keep1==1 ), color = "green")+
    #3a/ using individual trajectories
    geom_point(data = data%>%dplyr::filter(keep3==0, keep2==1 ), color = "cyan")+
    #3b/ using global log-linear model
    geom_point(data = data%>%dplyr::filter(KEEP==0, keep3==1 ), color = "blue")
  return(p)
}
