# WARNING - Generated by {fusen} from dev/flat_growth.Rmd: do not edit by hand


#' Plot predicted growth curve
#' 
#'Plot predicted percentiles from a growth model with data points
#' 
#' @param data \code{data.frame} including at least the numeric columns *Age*, *MeasurementValue* and *AnimalAnonID*.
#' @param data_percent \code{data.frame} including the predicted percentile from the growth model and  the numeric columns *Age*, *percentiles50* and other percentiles to plot.
#' @param title \code{character} Title of the plot.
#' 
#' @import dplyr assertthat 
#' @importFrom ggplot2 ggplot geom_point geom_line ggtitle geom_ribbon aes
#' @importFrom stringr str_subset str_remove
#'
#' @return Plot
#' 
#' @export
#' @examples
#' Age <- sample(c(0:10), 100, replace = TRUE)
#' AnimalAnonID <- sample(c(0:20), 100, replace = TRUE)
#' MeasurementValue <- exp(0.2+15 * (1 - exp(-(0.1) * log(Age+1)))+ 
#'                           rnorm(100,0,0.01) + AnimalAnonID*0.1)-1 
#' dat = data.frame(Age = Age, MeasurementValue = MeasurementValue, 
#'                  AnimalAnonID = AnimalAnonID, MeasurementType = "Live Weight")
#'
#' out = Gro_analysis(dat, 
#'                    all_mods = c("logistic", "vonBertalanffy", "gam"), 
#'                    percentiles = c(2.5, 97.5))
#'
#' p <- Gro_plot(data = dat, 
#'               data_percent = out$percent, 
#'               title =out$AIC_tab$model[1])
#' p
Gro_plot <- function(data, data_percent, title = "") {
  assert_that(is.data.frame(data))
  assert_that(is.data.frame(data_percent))
  assert_that(data %has_name% c("MeasurementValue","Age", 'AnimalAnonID'))
  assert_that(data_percent %has_name% c("percent50","Age"))
  
  assert_that(is.numeric(data$MeasurementValue))
  assert_that(is.numeric(data$Age))
  assert_that(is.numeric(data_percent$percent50))
  assert_that(is.numeric(data_percent$Age))
  
  percentiles = str_subset(names(data_percent), "percent")
  percentiles = str_subset(percentiles, "50", negate = T)
  percentiles = as.numeric(str_remove(percentiles, "percent"))
  
  
  p <- ggplot(data, aes (x = Age))+
    ggtitle(title)+
    geom_point(aes(y = MeasurementValue))
  
  if (length(percentiles)/2 == 1){
    colorrib ="grey80"
  }else{
    colorrib = paste0("grey", seq(30:90, length.out = length(percentiles)/2))}
  for (i in 1:(length(percentiles)/2) ){
    per = paste0("percent",abs(c(percentiles[i], 100-percentiles[i])))
    p <- p +
      geom_ribbon(data = data_percent,aes ( ymin = !!sym(per[1]), ymax = !!sym(per[2])),
                  fill = colorrib[i], alpha = 0.25)
  }
  p <- p +
    geom_line(data = data_percent,aes ( y = percent50 ))   
  return(p)
}
