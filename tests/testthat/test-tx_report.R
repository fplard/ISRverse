# WARNING - Generated by {fusen} from dev/flat_select.Rmd: do not edit by hand

test_that("tx_report works", {
  file = system.file("sci_Animal.csv", package = 'ISRverse')
  ZIMSdirtest = dirname(file)
  data <- Load_Zimsdata	(taxa = "Reptilia",
                         ZIMSdir = ZIMSdirtest,
                         Animal = TRUE, tables = c("Collection","DeathInformation", "Weight"))
  PlotDir = paste0(tempdir(check = TRUE),'\\temp')
  dir.create(PlotDir)
  
  out <- tx_report(species = "Testudo hermanni", taxa = "Reptilia",
                   data$Reptilia$Animal, data$Reptilia$Collection, MinBirthKnown = 0.1,
                   DeathInformation =data$Reptilia$DeathInformation, weights =data$Reptilia$Weight,
                   niter = 1000, burnin = 101, thinning = 10, nchain = 3, ncpus = 3,
                   PlotDir = PlotDir, Sections = c('sur','gro'),
                   sexCats = c("Male", "Female"),
                   models_sur = "GO", shape = "simple",
                   models_gro = "vonBertalanffy"
  )
  expect_named(out, c('general', "summary", 'surv', 'weig'))
  expect_named(out$general, c("Nraw", "Ndate", "Nglobal", "Nalive", "firstDate", "maxAgeraw", "extractdate"))
  expect_named(out$sur, c('Male', "Female"))
  expect_named(out$sur$Male, c("summary", "bastaRes", "DICmods", "relex", "Sur1", "Sur5", 'L90'))
  expect_named(out$weig, c('Male', "Female"))
  expect_named(out$weig$Male$Captive, c('wSummar', "weightQ"))
  expect_named(out$weig$Female$Captive, c('wSummar', "weightQ"))
  expect_true(file.exists(paste(PlotDir, "Testudo_hermanni_Male_LongThres.pdf", sep = '\\')))
  expect_true(file.exists(paste(PlotDir, "Testudo_hermanni_Femalesurcheck.pdf", sep = '\\')))
  expect_true(file.exists(paste(PlotDir, "Testudo_hermanni_Femalesurplot.pdf", sep = '\\')))
  expect_true(file.exists(paste(PlotDir, "Testudo_hermanni_Male_Captive_outliers.png", sep = '\\')))
  expect_true(file.exists(paste(PlotDir, "Testudo_hermanni_Male_Captive_growth.png", sep = '\\')))
  unlink(PlotDir, recursive = TRUE)
})
