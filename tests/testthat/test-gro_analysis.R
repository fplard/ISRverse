# WARNING - Generated by {fusen} from dev/flat_growth.Rmd: do not edit by hand

Age <- sample(c(0:10), 1000, replace = T)
MeasurementValue <- exp(0.2+15 * (1 - exp(-(0.1) * log(Age+1)))+ rnorm(1000,0,0.01))-1 
dat = data.frame(Age = Age, MeasurementValue = MeasurementValue)

test_that(
  "Gro_analysis error",
  {
    expect_error(dat$MeasurementValue %>% Gro_analysis(),
      regexp = "data_weight is not a data frame")
    expect_error(dat%>% Gro_analysis(percentiles = c(-0.2)))
  })

test_that(
  "Gro_analysis works",
  { 
  out = dat %>% Gro_analysis()
  expect_named(out,c("percent", "fit", "AIC_tab", "GOF"))
  expect_named(out$GOF,c("normal", "X", "var", "conv"))
  expect_type(as.logical(out$GOF), "logical")
  expect_named(out$percent,c("Age",  "2.5",  "97.5"))
  expect_type(out$percent$Age, "double")
  expect_type(out$percent$`2.5`, "double")
  expect_named(out$AIC_tab,c("model",  "k",  "AIC"))
  expect_type(out$AIC_tab$model, "character")
  expect_type(out$AIC_tab$AIC, "double")
  expect_type(out$AIC_tab$k, "double")
  expect_s4_class(out$fit, "mle2")
  out = dat %>% Gro_analysis(all_mods = c("logistic", "gompertz", "chapmanRichards", "vonBertalanffy", "polynomial"))
  })
